"use strict";const Phaser=window.Phaser,DEBUG=!1,DEBUG_VERBOSE=!1,DEBUG_LOCAL_MODE=!0,DEBUG_PHYSICS=!1,DEBUG_LIGHT=1,DEBUG_INVINCIBILITY=!1,DEBUG_CHUNK="",DEBUG_START_DIFFICULTY=0,GAME_WIDTH=375,GAME_HEIGHT=667,BAT_DISTANCE_FROM_EDGE=150,CHUNK_SPACING=50,ZOMBIE_GRASP_DISTANCE=316,BAT_MOVEMENT_SPEED=1e3,BAT_MOVEMENT_DRAG=.001,BAT_MOVEMENT_MAX_SPEED=200,GAME_SPEED=200,TREE_PARALLAX_SPEED=230,LIGHT_RADIUS_REDUCTION_INTERVAL=5e3,LIGHT_RADIUS_REDUCTION=8e-4,LIGHT_MIN_RADIUS=.6,LIGHT_MAX_RADIUS=1.8,LIGHT_START_RADIUS=1.5,BOTTLE_LIGHT_RADIUS=.35,CLOUD_SCROLL_SPEED=80,POINTS_BOTTLE=500,POINTS_COLLECTABLE=100,DIFFICULTY_PROGRESSION=[2,3,4,6],CLUE_CHUNKS=[null,"chunk03","chunk09","chunk10"],CHUNKS=[["chunk01",1],["chunk02",1],["chunk03",-1],["chunk04",2],["chunk05",0],["chunk06",0],["chunk07",1],["chunk08",1],["chunk09",-2],["chunk10",-3],["chunk11",2],["chunk12",3],["chunk13",3],["chunk14",1],["chunk15",0],["chunk16",1],["chunk17",0],["chunk18",0],["chunk19",3],["chunk20",2],["chunk21",3],["chunk22",2],["chunk23",3],["chunk24",3]],LAYER_HUD=1e4,LAYER_CLOUDS=5e3,LAYER_TREES=4e3,LAYER_EFFECTS=4e3,LAYER_BAT=3e3,LAYER_OBSTACLE_UPPER=2001,LAYER_LIGHT=2e3,LAYER_OBSTACLE_LOWER=0,LAYER_GROUND_DETAILS=-1e3,LAYER_GROUND=-2e3;let game=new Phaser.Game({type:Phaser.CANVAS,width:375,height:667,backgroundColor:"#000000",parent:"canvas-container",roundPixels:!0,powerPreference:"high-performance",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},input:{activePointers:4}});game.scene.add("Preload",{preload:function(){this.load.aseprite("reward","assets/reward.webp","assets/reward.json"),this.load.aseprite("bat","assets/bat.webp","assets/bat.json"),this.load.aseprite("collision","assets/collision.webp","assets/collision.json"),this.load.aseprite("zombie","assets/zombie.webp","assets/zombie.json"),this.load.aseprite("zombie-black","assets/zombie-black.webp","assets/zombie-black.json"),this.load.atlas("atlas","assets/atlas.webp","assets/atlas.json"),this.load.image("go-ghost1","assets/ghost1.webp"),this.load.image("go-ghost2","assets/ghost2.webp"),this.load.image("go-grass","assets/grass.webp"),this.load.image("tunnel","assets/tunnel.webp"),this.load.image("tunnel-glow","assets/tunnel-glow.webp"),this.load.image("endofgame_top","assets/endofgame_top.webp"),this.load.image("endofgame_bottom","assets/endofgame_bottom.webp"),this.load.image("clue1","assets/clue-0.webp"),this.load.image("clue2","assets/clue-1.webp"),this.load.image("clue3","assets/clue-2.webp"),this.load.image("bottle-light","assets/bottle-light.webp"),this.load.image("new-clues","assets/new-clues.webp"),this.load.image("clue-reveal-bottle","assets/clue-reveal-bottle.webp"),this.load.image("clue-reveal-bg","assets/clue-reveal-bg.webp");for(let e=0;e<CHUNKS.length;e++){let t=CHUNKS[e][0];this.load.json(t,"chunks/"+t+".json")}},create:function(){this.anims.createFromAseprite("reward"),this.anims.createFromAseprite("collision"),this.anims.createFromAseprite("zombie")[1].repeat=-1,this.anims.createFromAseprite("zombie-black")[1].repeat=-1,this.anims.createFromAseprite("bat")[0].repeat=-1;let e=0;for(let t=0;t<DIFFICULTY_PROGRESSION.length;t++)e+=DIFFICULTY_PROGRESSION[t];this.registry.values.totalChunkCount=e,this.registry.values.maxDistance=717*e;let t=[];for(let e=0;e<CHUNKS.length;e++){let s=CHUNKS[e][0],a=CHUNKS[e][1];null==t[a]&&(t[a]=[]),t[a].push(s)}if(this.registry.values.chunksByDifficulty=t,0)for(let e=0;e<this.registry.values.chunksByDifficulty.length;e++){this.registry.values.chunksByDifficulty[e].length}isGameReady=!0,startGame()}},!0);let isAudioLoaded=!1;game.scene.add("WaitForInput",{create:function(){if(this.input.on("pointerdown",(function(){game.scene.stop("WaitForInput"),isAudioLoaded?game.scene.start("Game"):game.scene.start("PreloadAudio")})),1)return game.scene.stop("WaitForInput"),void(isAudioLoaded?game.scene.start("Game"):game.scene.start("PreloadAudio"));let e="TAP TO START";this.sys.game.device.os.desktop&&(e="CLICK TO START");let t=this.add.text(187.5,333.5,e);t.x-=t.width/2}}),game.scene.add("PreloadAudio",{preload:function(){this.load.audio("collect1",["assets/collect1.mp3"]),this.load.audio("collect2",["assets/collect2.mp3"]),this.load.audio("impact1",["assets/impact1.mp3"]),this.load.audio("impact2",["assets/impact2.mp3"]),this.load.audio("collect-clue-bottle",["assets/pickup-clue-bottle.mp3"]),this.load.audio("collect-glow-bottle",["assets/pickup-glow-bottle.mp3"]),this.load.audio("win",["assets/win-stinger.mp3"]),this.load.audio("lose",["assets/lose-stinger.mp3"]),this.load.audio("clue-reveal",["assets/clue-reveal.mp3"]),this.load.audio("tunnel",["assets/tunnel-stinger.mp3"])},create:function(){isAudioLoaded=!0,game.scene.stop("PreloadAudio"),game.scene.start("Game")}}),game.scene.add("Game",{physics:{default:"arcade",arcade:{debug:false,debugShowStaticBody:false,height:1e3,fixedStep:!1,overlapBias:0,checkCollision:{up:!1,down:!1,left:!0,right:!0}}},create:function(){if(this.ref={},this.data.values.distance=-667,this.data.values.totalChunksPlayed=0,this.data.values.lives=3,this.data.values.score=0,this.data.values.clues=0,this.data.values.lightRadius=1.5,this.data.values.lightDirty=!0,this.data.values.isDead=!1,this.data.values.isGameOver=!1,this.data.values.fadeOutBackgroundObjects=!1,this.data.values.touches=[],this.data.values.lowFpsMode=!1,this.data.values.isPaused=!1,this.data.values.difficulty=0,this.data.values.chunkCount=0,this.data.values.lastChunkIndex=-1,this.add.rectangle(1,1,373,665,"0xBDFCB5").setOrigin(0,0).setDepth(-2e3),this.ref.chunkMarker=this.physics.add.body(0,0).setVelocity(0,200),this.ref.moveLeft=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.ref.moveRight=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),this.ref.pause=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC).on("down",(()=>{this.data.values.isPaused?this.resumeGame():this.pauseGame()})),this.ref.pauseAlt=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P).on("down",(()=>{this.data.values.isPaused?this.resumeGame():this.pauseGame()})),0){this.ref.fps=this.add.text(0,651,this.game.loop.actualFps,{align:"left",stroke:"#ffffff",color:"#ffffff",fontSize:20,strokeThickness:1}).setDepth(1e6),this.ref.delta=this.add.text(0,635,"",{align:"left",stroke:"#ffffff",color:"#ffffff",fontSize:20,strokeThickness:1}).setDepth(1e6),this.ref.bodyCount=this.add.text(0,619,"",{align:"left",stroke:"#ffffff",color:"#ffffff",fontSize:20,strokeThickness:1}).setDepth(1e6),this.ref.touch=this.add.text(0,603,"",{align:"left",stroke:"#ffffff",color:"#ffffff",fontSize:20,strokeThickness:1}).setDepth(1e6);let e=this.add.text(290,32,"CHUNK01",{align:"left",stroke:"#ffffff",color:"#ffffff",fontSize:12,strokeThickness:0}).setDepth(1e6);this.ref.chunkName=this.physics.add.existing(e).body.setVelocity(0,200)}this.setupPlayer(),this.setupObstacles(),this.setupEffects(),this.setupHud(),this.setupLight(),this.setupScrollingObjects(),this.setupPopups(),this.setupEffects(),this.addRandomChunk(),this.setProgress(0),this.setClueCount(0),this.game.events.addListener(Phaser.Core.Events.BLUR,this.pauseGame,this)},update:function(e,t){let s=t/1e3;if(0){if(this.ref.fps.text=Math.round(this.game.loop.actualFps),0){let e=this.data.values.touches,s=e[e.length-1];this.ref.touch.text=null==s?"count=0":"count="+e.length+" id="+s.id+" x="+s.x,this.ref.delta.text=Math.round(100*(t+Number.EPSILON))/100;let a=this.physics.world.bodies.entries.length,i=this.ref.activeEffects.length,l=this.ref.activePopups.length,o=this.ref.obstacleGroup.countActive(),r=this.ref.obstacleUpperGroup.countActive();this.ref.bodyCount.text="B:"+a+" O: "+o+" U: "+r+" E:"+i+" P:"+l}this.ref.chunkName.y>667&&(this.ref.chunkName.y=0)}if(this.data.values.isPaused)return;this.updateBat(),this.updateObstacles(),this.updateLight(),this.checkLowFps(),this.updateTempObjects(s,this.ref.activeEffects,this.ref.effectGroup),this.updateTempObjects(s,this.ref.activePopups,this.ref.popupGroup);for(let e=0;e<this.ref.scrollingObjects.length;e++){let t=this.ref.scrollingObjects[e];t[0].y+=s*t[1],this.data.values.fadeOutBackgroundObjects&&(t[0].alpha-=2*s),t[0].y>=667&&(t[0].y=-t[0].height,t[2]&&(t[0].x=Phaser.Math.RND.integerInRange(0,375)))}this.data.values.distance+=200*s;let a=this.data.values.distance/this.registry.values.maxDistance;if(this.setProgress(a),this.ref.chunkMarker.y>667&&this.data.values.totalChunksPlayed<this.registry.values.totalChunkCount&&(this.ref.chunkMarker.y=-50,this.addRandomChunk()),this.data.values.distance>=this.registry.values.maxDistance&&(this.data.values.fadeOutBackgroundObjects=!0),this.data.values.distance>this.registry.values.maxDistance+667/4){let e=this.data.values.score;this.saveScore(e);let t=this.data.values.clues,s=this.ref.player.body.x,a=this.ref.player.frame;this.game.scene.stop("Game"),this.game.scene.start("EndOfGame",{score:e,lightRadius:this.data.values.lightRadius,batX:s,batFrame:a,clues:t})}else if(this.data.values.isGameOver){let e=this.data.values.score;this.saveScore(e);let t=this.data.values.clues;this.game.scene.stop("Game"),this.game.scene.start("GameOver",{score:e,clues:t})}},extend:{saveScore(e){var t=localStorage.getItem("highscore");(null===t||e>Number.parseInt(t))&&localStorage.setItem("highscore",e),localStorage.setItem("score",e)},pageTouchStart(e){let t=e.changedTouches[0];this.scene.scene.data.values.touches.push({id:t.identifier,x:t.clientX})},pageTouchEnd(e){let t=e.changedTouches[0],s=this.scene.scene.data.values.touches;for(let e=0;e<s.length;e++)s[e].id==t.identifier&&s.splice(e,1)},pageTouchMove(e){let t=e.changedTouches[0],s=this.scene.scene.data.values.touches;for(let e=0;e<s.length;e++)if(s[e].id==t.identifier){s[e].x=t.clientX;break}},pauseGame:function(){if(!this.game.scene.isActive("Game"))return;if(this.data.values.isPaused)return;this.data.values.isPaused=!0,this.physics.pause(),this.ref.pauseLayer.setVisible(!0),this.ref.hudLayer.setVisible(!1);let e=this.data.values.score;this.ref.pauseScoreText.text=e.toString().padStart(6,"0");let t=localStorage.getItem("highscore");t=null==t?e:parseInt(t),e>t&&(t=e),this.ref.highScoreText.text=t.toString().padStart(6,"0")},resumeGame:function(){this.data.values.isPaused&&(this.data.values.isPaused=!1,this.physics.resume(),this.ref.pauseLayer.setVisible(!1),this.ref.hudLayer.setVisible(!0))},updateTempObjects:function(e,t,s){for(let a=t.length-1;a>=0;a--){let i=t[a];i.y+=200*e,null!=i.anims&&i.anims.isPlaying||(i.y<667||(null==i.data||null==i.data.values.group?s.killAndHide(i):i.data.values.group.killAndHide(i),t.splice(a,1)))}},setupPopups:function(){let e=this;this.ref.activePopups=[],this.ref.popupGroup=[],this.ref.popupGroup[0]=this.add.group({visible:!1,active:!1,classType:Phaser.GameObjects.Text,createCallback:function(t){t.setText("+100").setStyle({align:"center",stroke:"#000000",color:"#ffffff",fontSize:30,strokeThickness:4,fontFamily:"FantaPop"}).setDepth(4e3).setOrigin(.5,.5),t.setData("group",e.ref.popupGroup[0])}}),this.ref.popupGroup[1]=this.add.group({visible:!1,active:!1,classType:Phaser.GameObjects.Text,createCallback:function(t){t.setText("+500").setStyle({align:"center",stroke:"#000000",color:"#ffffff",fontSize:30,strokeThickness:4,fontFamily:"FantaPop"}).setDepth(4e3).setOrigin(.5,.5),t.setData("group",e.ref.popupGroup[1])}}),this.ref.popupGroup[2]=this.add.group({visible:!1,active:!1,classType:Phaser.GameObjects.Text,createCallback:function(t){t.setText("+CLUE").setStyle({align:"center",stroke:"#000000",color:"#ffffff",fontSize:30,strokeThickness:4,fontFamily:"FantaPop"}).setDepth(4e3).setOrigin(.5,.5),t.setData("group",e.ref.popupGroup[2])}});for(let e=0;e<10;e++){let e=this.ref.popupGroup[0].create();this.ref.popupGroup[0].killAndHide(e)}for(let e=0;e<2;e++){let e=this.ref.popupGroup[1].create();this.ref.popupGroup[1].killAndHide(e)}for(let e=0;e<1;e++){let e=this.ref.popupGroup[2].create();this.ref.popupGroup[2].killAndHide(e)}},addPopup:function(e,t,s){let a=this.ref.popupGroup[s].get(e,t).setActive(!0).setVisible(!0);return this.ref.activePopups.push(a),a},setupEffects:function(){this.ref.activeEffects=[],this.ref.effectGroup=this.add.group({visible:!1,active:!1})},createEffect:function(e,t){return this.ref.effectGroup.get(e,t).setOrigin(.5,.5).setDepth(4e3).setActive(!0).setVisible(!0)},playCollisionAnim:function(e,t){let s=this.createEffect(e,t);s.setTexture("collision");let a=Phaser.Math.RND.integerInRange(0,359);s.setRotation(Phaser.Math.DEG_TO_RAD*a),s.play("collision"),this.ref.activeEffects.push(s)},playRewardAnim:function(e,t){let s=this.createEffect(e,t);s.setTexture("reward");let a=Phaser.Math.RND.integerInRange(0,359);s.setRotation(Phaser.Math.DEG_TO_RAD*a),s.play("reward"),this.ref.activeEffects.push(s)},setupPlayer:function(){let e=this.add.sprite(0,0,"bat").play("bat").setOrigin(0,0),t=this.add.container(187.5-e.width/2,517,[e]).setDepth(3e3),s=this.physics.add.existing(t);s.body.setSize(50,20).setOffset(12,10).setAllowDrag(!0).setDrag(.001).setCollideWorldBounds(!0).setMaxSpeed(200),s.body.useDamping=!0,this.ref.player=s},setupScrollingObjects:function(){let e=[],t=[],s=[],a=["grass","stone","stones","stones","grass","stone","stone","stones","grass"];for(let t=0;t<a.length;t++){let s=60,i=Phaser.Math.RND.integerInRange(0,375),l=t*s+Phaser.Math.RND.integerInRange(0,s),o=this.add.image(i,l,"atlas",a[t]).setDepth(-1e3).setAlpha(1);e.push([o,200,!0])}let i=[["clouds1",70,.05,-300],["clouds2",70,.05,0],["clouds3",70,.05,300],["clouds2",70,.05,600],["clouds3",150,.05,0],["clouds4",120,.05,-200]];for(let s=0;s<i.length;s++){let a=i[s][1],l=i[s][2],o=i[s][0],r=i[s][3],n=this.add.image(0,r,"atlas",o).setOrigin(0,0).setDepth(5e3).setAlpha(l);t.push(n),e.push([n,a,!1])}for(let t=0;t<2;t++){let a=this.add.image(0,667*t,"atlas","trees").setAlpha(1).setDepth(4e3).setOrigin(0,0);a.x=375-a.width,e.push([a,230,!1]),s.push(a)}for(let t=0;t<2;t++){let a=this.add.image(0,667*t,"atlas","trees").setAlpha(1).setDepth(4e3).setRotation(180*Phaser.Math.DEG_TO_RAD).setOrigin(1,1);a.x=0,e.push([a,230]),s.push(a)}this.ref.trees=s,this.ref.clouds=t,this.ref.scrollingObjects=e},checkLowFps:function(){this.data.values.lowFpsMode||this.game.loop.actualFps>=50||(this.enableLowFpsMode(),this.data.values.lowFpsMode=!0)},enableLowFpsMode:function(){for(let e=0;e<this.ref.clouds.length;e++){this.ref.clouds[e].setVisible(!1)}for(let e=0;e<this.ref.trees.length;e++){this.ref.trees[e].setVisible(!1)}},addRandomChunk:function(){let e=-667;if("".length>0)return void this.addChunk("",e);let t=this.data.values.difficulty;if(this.data.values.chunkCount==DIFFICULTY_PROGRESSION[t]-1&&null!=CLUE_CHUNKS[t]){let s=CLUE_CHUNKS[t];return void this.addChunk(s,e)}let s=this.registry.values.chunksByDifficulty[t],a=Phaser.Math.RND.integerInRange(0,s.length-1),i=this.data.values.lastChunkIndex;if(-1!=i&&i==a)return void this.addRandomChunk();this.data.values.lastChunkIndex=a;let l=s[a];this.addChunk(l,e)},addUpperObstacle:function(e,t){let s=this.ref.obstacleUpperGroup.get(e.x,e.y).setTexture("atlas",t).setFlipX(e.flipX).setDepth(2001).setActive(!0).setVisible(!0);s.depth+=667+s.y,this.ref.upperObstacles.push([e,s])},addChunk:function(e,t){let s=this.cache.json.get(e),a=this.data.values.difficulty;this.data.values.chunkCount++,this.data.values.totalChunksPlayed++,this.data.values.chunkCount==DIFFICULTY_PROGRESSION[a]&&(this.data.values.difficulty=Math.min(a+1,DIFFICULTY_PROGRESSION.length-1),this.data.values.chunkCount=0,this.data.values.lastChunkIndex=-1);let i=s.layers[0].entities;for(let e=0;e<i.length;e++){let s=i[e],a=this.ref.obstacleGroup.get(s.x,s.y+t).setVelocity(0,200).setDepth(0).setActive(!0).setFlipX(null!=s.flippedX&&s.flippedX).setVisible(!0);switch(a.setData("children",[]),a.body.setEnable(!0),a.body.collideWorldBounds=!1,a.body.customSeparateX=!1,a.body.customSeparateY=!1,a.stop(),a.anims.currentAnim=null,a.depth+=a.y,s.name){case"zombie":a.setTexture("zombie").setDepth(2668).setName("zombie").setVisible(!1).setSize(60,20);break;case"gravestone_large":a.setTexture("atlas","gravestone-large-lower").setName("gravestone-large").setSize(45,70),this.addUpperObstacle(a,"gravestone-large");break;case"gravestone_small":a.setTexture("atlas","gravestone-small-lower").setName("gravestone-small").setSize(30,50),this.addUpperObstacle(a,"gravestone-small");break;case"collectable":a.setTexture("atlas","collectable").setName("collectable").setCircle(15,7,10),this.addUpperObstacle(a,"collectable");break;case"pumpkin":a.setTexture("atlas","pumpkin-lower").setName("pumpkin").setCircle(28,2,10),this.addUpperObstacle(a,"pumpkin");break;case"glow_bottle":a.setTexture("atlas","fanta-light-lower").setName("fanta-light").setSize(28,40).setOffset(4,8),this.addUpperObstacle(a,"fanta-light");break;case"clue_bottle":{a.setTexture("atlas","fanta-clue-lower").setName("fanta-clue").setCircle(16,-5,5),this.addUpperObstacle(a,"fanta-clue");let e=this.ref.obstacleGroup.get(s.x,s.y+t).setTexture(null).setName("fanta-clue").setVisible(!1).setData("children",[]).setActive(!0).setVelocity(0,200).setCircle(16,0,20);e.body.setEnable(!0),e.data.values.children.push(a),a.data.values.children.push(e)}}}},setupLight:function(){let e=createLightContainer(this);e.x=187.5,e.y=this.ref.player.body.y+20,this.ref.lightContainer=e,this.updateLight()},setProgress:function(e){let t=Math.min(Math.max(e,0),1),s=this.data.values.progressMax*(1-t);this.ref.progressBarMask.y=s,this.ref.progressBat.y=s+16},setClueCount:function(e){for(let t=0;t<3;t++){let s=t+1<=e;this.ref.cluesFilled[t].setVisible(s),this.ref.cluesOutline[t].setVisible(!s),this.ref.clueText.text=e}},setupHud:function(){let e=[];this.ref.hearts=e;let t=[];this.ref.cluesFilled=t;let s=[];this.ref.cluesOutline=s;let a=this.add.text(68,58,"000000",{fontSize:18,strokeThickness:0,fontFamily:"FantaPop"});this.ref.scoreText=a;let i=this.add.text(106,20,"0",{fontSize:18,strokeThickness:0,fontFamily:"FantaPop"});this.ref.clueText=i;let l=this.add.image(327,16,"atlas","progress-bar-fg").setScale(1,1).setOrigin(0,0),o=this.make.graphics().fillStyle(16777215,1).fillRect(327,16,l.width,l.height);o.y+=l.height;var r=l.createGeometryMask(o);l.setMask(r),this.ref.progressBarMask=o,this.data.values.progressMax=l.height;let n=this.add.image(327,0,"atlas","progress-bat").setOrigin(0,0),h=this.make.graphics().fillStyle(16777215,1).fillRect(327,16,l.width,l.height);var d=l.createGeometryMask(h);n.setMask(d),this.ref.progressBat=n;let u=this.add.image(320,150,"atlas","pause").setOrigin(0,0).setInteractive({useHandCursor:!0}).on("pointerdown",(function(e,t,s,a){this.scene.pauseGame()})),c=this.add.layer();c.add([this.add.image(327,16,"atlas","progress-bar-bg").setOrigin(0,0),l,n,u,this.add.image(32,16,"atlas","hud-bar").setOrigin(0,0),this.add.image(32,53,"atlas","hud-bar").setOrigin(0,0),this.add.image(32,89,"atlas","hud-bar").setOrigin(0,0),this.add.image(45,58,"atlas","score-icon").setOrigin(0,0),i,this.add.text(98,22,"x",{fontSize:14,strokeThickness:0,fontFamily:"FantaPop"}),a,e[0]=this.add.image(45,94,"atlas","heart").setOrigin(0,0),e[1]=this.add.image(72,94,"atlas","heart").setOrigin(0,0),e[2]=this.add.image(99,94,"atlas","heart").setOrigin(0,0),t[0]=this.add.image(50,21,"atlas","icon-clue-filled").setOrigin(0,0),t[1]=this.add.image(65,21,"atlas","icon-clue-filled").setOrigin(0,0),t[2]=this.add.image(80,21,"atlas","icon-clue-filled").setOrigin(0,0),s[0]=this.add.image(50,21,"atlas","icon-clue-outline").setOrigin(0,0),s[1]=this.add.image(65,21,"atlas","icon-clue-outline").setOrigin(0,0),s[2]=this.add.image(80,21,"atlas","icon-clue-outline").setOrigin(0,0)]),c.setDepth(1e4),this.ref.hudLayer=c;let p=this.add.image(187.5,433.5,"atlas","resume").setOrigin(.5,.5).setInteractive({useHandCursor:!0}).on("pointerdown",(function(e,t,s,a){this.scene.resumeGame()})),f=this.add.layer();f.add([this.add.rectangle(0,0,375,667,"0x000000").setOrigin(0,0).setAlpha(.8),this.add.image(0,667,"go-grass").setOrigin(0,1),p,this.add.text(102.5,283.5,"your score",{fontSize:20,fontFamily:"FantaPop",color:"#ffffff"}).setOrigin(.5,0),this.ref.pauseScoreText=this.add.text(102.5,308.5,"000000",{fontSize:45,fontFamily:"FantaPop",color:"#ffffff"}).setOrigin(.5,0),this.add.text(272.5,283.5,"BEST SCORE",{fontSize:20,strokeThickness:0,fontFamily:"FantaPop"}).setOrigin(.5,0),this.ref.highScoreText=this.add.text(272.5,308.5,"x",{fontSize:45,strokeThickness:0,fontFamily:"FantaPop"}).setOrigin(.5,0)]),f.setDepth(10010).setVisible(!1),this.ref.pauseLayer=f},animateLightRadius:function(e){let t=null;t=this.data.values.lightRadius+e>1.8?1.8:"+"+e,this.tweens.add({targets:this.data.values,lightRadius:t,ease:"Quad",duration:500,repeat:0,yoyo:!1})},setLightRadius:function(e){let t=this.data.values.lightRadius;this.data.values.lightRadius=Math.min(Math.max(t+e,.6),1.8),this.data.values.lightDirty=!0},updateLight:function(){this.setLightRadius(-8e-4);let e=this.ref.player;this.ref.lightContainer.x=e.body.x+30,this.data.values.lightDirty&&(this.ref.lightContainer.setScale(this.data.values.lightRadius),this.data.values.lightDirty=!1)},removeLife:function(){if(0)return;let e=this.data.values.lives;if(0==e)return;if(e--,this.data.values.lives=e,0==e){this.data.values.isDead=!0,this.ref.player.body.setVelocity(0,200).setAccelerationX(0);let e=this;return void this.tweens.add({targets:this.ref.player,alpha:0,ease:"Expo.easeOut",duration:500,repeat:0,yoyo:!1,onComplete:function(){e.data.values.isGameOver=!0}})}let t=this.ref.hearts;for(let s=0;s<t.length;s++)s<e?t[s].setAlpha(1):t[s].setAlpha(.2)},addPoints:function(e){let t=this.data.values.score;t+=e,this.data.values.score=t;let s=t.toString().padStart(6,"0");this.ref.scoreText.text=s},updateBat:function(){if(this.data.values.isDead)return;let e=this.ref.player;this.canMoveLeft()?(e.body.velocity.x>0&&(e.body.velocity.x=0),e.body.setAccelerationX(-1e3)):this.canMoveRight()?(e.body.velocity.x<0&&(e.body.velocity.x=0),e.body.setAccelerationX(1e3)):e.body.setAccelerationX(0)},canMoveLeft:function(){if(this.sys.game.device.os.desktop){return this.ref.moveLeft.isDown}{if(0==this.data.values.touches.length)return!1;let e=this.data.values.touches;return e[e.length-1].x<187.5}},canMoveRight:function(){if(this.sys.game.device.os.desktop){return this.ref.moveRight.isDown}{if(0==this.data.values.touches.length)return!1;let e=this.data.values.touches;return e[e.length-1].x>=187.5}},setupObstacles:function(){this.ref.obstacleGroup=this.physics.add.group({visible:!1,active:!1}),this.ref.obstacleUpperGroup=this.add.group({visible:!1,active:!1});for(let e=0;e<20;e++){let e=this.ref.obstacleGroup.create(0,0,null,null,!1,!1);this.ref.obstacleGroup.killAndHide(e);let t=this.ref.obstacleUpperGroup.create(0,0,null,null,!1,!1);this.ref.obstacleUpperGroup.killAndHide(t)}this.ref.upperObstacles=[]},updateObstacles:function(){let e=this.ref.player,t=this.ref.obstacleGroup;for(let s=0;s<t.children.size;s++){let a=t.children.entries[s];if(a.active)if("zombie"==a.name&&a.y>=316&&null==a.anims.currentAnim&&(a.setVisible(!0),a.chain(["reach","grab"]),a.stop()),!this.data.values.isDead&&a.y>e.y-50&&this.physics.overlap(e,a)){switch(a.body.enable=!1,t.killAndHide(a),a.name){case"gravestone-large":case"gravestone-small":case"zombie":case"pumpkin":{let e=Phaser.Math.RND.realInRange(.8,1.2);Math.random()>.5?this.sound.play("impact1",{rate:e}):this.sound.play("impact2",{rate:e}),this.removeLife(),this.playCollisionAnim(a.x,a.y);break}case"collectable":{let e=Phaser.Math.RND.realInRange(.8,1.2);Math.random()>.5?this.sound.play("collect1",{rate:e}):this.sound.play("collect2",{rate:e}),this.addPoints(100),this.playRewardAnim(a.x,a.y),this.addPopup(a.x,a.y-8,0);break}case"fanta-light":this.sound.play("collect-glow-bottle",{rate:.8}),this.animateLightRadius(.35),this.addPoints(500),this.playRewardAnim(a.x,a.y),this.addPopup(a.x,a.y-8,1);break;case"fanta-clue":this.sound.play("collect-clue-bottle"),this.data.values.clues++,this.setClueCount(this.data.values.clues),this.playRewardAnim(a.x,a.y),this.addPopup(a.x,a.y-8,2);break}for(let e=0;e<a.data.values.children.length;e++){let s=a.data.values.children[e];s.body.enable=!1,t.killAndHide(s)}}else a.body.y>667&&t.killAndHide(a)}let s=this.ref.obstacleUpperGroup;for(let e=this.ref.upperObstacles.length-1;e>=0;e--){let t=this.ref.upperObstacles[e],a=t[0],i=t[1];a.visible?(i.x=a.x,i.y=a.y+4):(this.ref.upperObstacles.splice(e,1),s.killAndHide(i))}}}}),game.scene.add("EndOfGame",{create:function(e){let t=[],s=this.add.rectangle(0,300,375,667,"0xBEFDB7").setOrigin(0,0).setDepth(-2e3),a=this.add.image(0,0,"endofgame_bottom").setOrigin(0,0).setDepth(-1999),i=this.add.image(0,0,"endofgame_top").setOrigin(0,0).setDepth(-1999),l=this.add.sprite(0,0,"bat").play("bat").setFrame(e.batFrame).setOrigin(.5,.5);l.setPosition(e.batX+l.width/2,517+l.height/2);let o=this.add.image(0,-25,"tunnel-glow").setOrigin(0,0).setDepth(-1999),r=this.add.sprite(272.5,268.5,"zombie-black").setScale(.7).setRotation(90*Phaser.Math.DEG_TO_RAD).setOrigin(0,0).setDepth(-1999).play("grab-black"),n=this.add.sprite(137.5,303.5,"zombie-black").setScale(.7).setRotation(-90*Phaser.Math.DEG_TO_RAD).setOrigin(0,0).setFlipX(!0).setDepth(-1999).play("grab-black");t.push(s),t.push(a),t.push(o);let h=[];for(let e=0;e<9;e++){let s=this.add.image(187.5,208.5,"tunnel").setDepth(-1999).setAlpha(1).setScale(0).setRotation(50*e*Phaser.Math.DEG_TO_RAD);h.push(s),t.push(s)}t.push(r),t.push(n),t.push(i);let d=createLightContainer(this);d.scale=e.lightRadius,d.x=l.x,d.y=l.y+20,this.tweens.add({targets:[l,d],x:187.5,ease:"Expo",duration:2e3,repeat:0,yoyo:!1}),this.tweens.add({targets:d,scale:3,ease:"Quad",duration:3e3,repeat:0,yoyo:!1});let u=this.add.container(0,-667,t).setDepth(-2e3),c=[];for(let e=0;e<h.length;e++){let t=this.tweens.add({targets:h[e],delay:700*e,scale:2,rotation:{from:0,to:90*-Phaser.Math.DEG_TO_RAD},ease:"Expo.easeIn",duration:7e3,repeat:-1,yoyo:!1}).seek(5e3).pause();c.push(t)}this.time.addEvent({delay:2500,loop:!1,callback:()=>{for(let e=0;e<c.length;e++)c[e].resume()}});let p=this;this.tweens.chain({delay:1e3,tweens:[{targets:l,y:408.5,ease:"QuadInOut",duration:1500,repeat:0,yoyo:!1,onComplete:function(){p.sound.play("tunnel")}},{targets:l,scale:{from:1,to:0},ease:"ExpoOut",duration:2e3,repeat:0,yoyo:!1},{targets:l,alpha:0,duration:1e3,repeat:0,yoyo:!1,onComplete:function(){p.game.scene.stop("EndOfGame"),e.clues>0?p.game.scene.start("ClueReveal",{clues:e.clues,playerWon:!0}):handoffToFrontEnd()}}]}),this.tweens.chain({delay:2e3,tweens:[{targets:[i,s,r,n],alpha:{from:1,to:0},ease:"Quad",duration:600,repeat:0,yoyo:!1},{targets:[a],alpha:{from:1,to:0},ease:"Quad",duration:800,repeat:0,yoyo:!1}]}),this.tweens.add({targets:u,y:{from:-300,to:200},ease:"Expo",duration:4e3,repeat:0,yoyo:!1}),this.sound.play("win")}}),game.scene.add("GameOver",{create:function(e){let t=this.add.image(187.5,667,"go-ghost1").setScale(0).setRotation(-45*Phaser.Math.DEG_TO_RAD),s=this.add.image(187.5,667,"go-ghost2").setScale(0).setRotation(45*Phaser.Math.DEG_TO_RAD);this.tweens.add({targets:t,x:212.5,ease:"Quad",duration:1e3,repeat:0,yoyo:!1}),this.tweens.add({targets:s,x:162.5,ease:"Quad",duration:1e3,repeat:0,yoyo:!1}),this.tweens.add({targets:[t,s],y:283.5,ease:"Expo",duration:1500,repeat:0,yoyo:!1}),this.tweens.add({targets:[t,s],scale:1,ease:"Expo",duration:700,repeat:0,yoyo:!1}),this.tweens.add({targets:[t,s],rotation:0,ease:"Quad",duration:500,repeat:0,yoyo:!1}),this.add.image(0,667,"go-grass").setOrigin(0,1);let a=this.add.text(112.5,358.5,"Game over!",{align:"center",stroke:"#000000",color:"#ffffff",fontSize:50,strokeThickness:4,fontFamily:"FantaPop"}).setAlpha(0).setScale(.8).setOrigin(0,0);this.tweens.add({targets:a,delay:500,x:a.x-22,scale:1,ease:"Quad",duration:1e3,repeat:0,yoyo:!1}),this.tweens.add({targets:a,delay:500,alpha:1,ease:"ExpoIn",duration:1e3,repeat:0,yoyo:!1});let i=this,l=function(){i.game.scene.stop("GameOver"),e.clues>0?i.game.scene.start("ClueReveal",{clues:e.clues,playerWon:!1}):handoffToFrontEnd()};this.sound.play("lose"),this.time.addEvent({delay:3e3,loop:!1,callback:()=>{this.sys.game.device.os.desktop?this.input.keyboard.on("keydown",l):this.input.on("pointerdown",l)}}),this.time.addEvent({delay:7e3,loop:!1,callback:l})}}),game.scene.add("ClueReveal",{create:function(e){let t=[];this.add.image(0,0,"clue-reveal-bg").setOrigin(0,0);let s=this.add.image(187.5,183.5,"bottle-light");t.push(s);let a=[["clue1","clue2","clue3"],["clue1","clue2","clue3"],["clue2","clue1","clue3"],["clue2","clue1","clue3"],["clue3","clue2","clue1"],["clue3","clue2","clue1"],["clue1","clue3","clue2"],["clue1","clue3","clue2"],["clue2","clue3","clue1"],["clue2","clue3","clue1"],["clue3","clue1","clue2"],["clue3","clue1","clue2"]],i=0,l=localStorage.getItem("clueArrayIndex");null!=l&&(i=parseInt(l)),i>=a.length&&(i=0);let o=a[i];localStorage.setItem("clueArrayIndex",i+1);let r=203.5;e.clues>=3?(t.push(this.add.image(187.5,r,o[0])),t.push(this.add.image(187.5,263.5,o[1])),t.push(this.add.image(187.5,323.5,o[2]))):e.clues>=2?(t.push(this.add.image(187.5,233.5,o[0])),t.push(this.add.image(187.5,293.5,o[1]))):e.clues>=1&&t.push(this.add.image(187.5,263.5,o[0]));let n=this.add.container(0,0,t);this.add.image(187.5,443.5,"clue-reveal-bottle"),this.add.image(187.5,133.5,"new-clues");let h="TAP TO CONTINUE";this.sys.game.device.os.desktop&&(h="PRESS ANY KEY");let d=this.add.text(187.5,533.5,h,{align:"center",fontSize:18,strokeThickness:0,fontFamily:"FantaPop"}).setAlpha(0).setOrigin(.5,.5),u=403.5,c=this.make.graphics().fillStyle(16777215,1).beginPath().moveTo(187.5,u).arc(187.5,u,600,0,0,!0).closePath().fillPath();c.left=0,c.right=359;var p=n.createGeometryMask(c);n.setMask(p),this.tweens.add({targets:c,left:{from:-90,to:0},right:{from:270,to:180},ease:"Quad",duration:3e3,repeat:0,yoyo:!1,onUpdate:function(e,t,s,a,i,l){c.clear().fillStyle(16777215,1).beginPath().moveTo(187.5,u).arc(187.5,u,600,Phaser.Math.DEG_TO_RAD*c.left,Phaser.Math.DEG_TO_RAD*c.right,!0).closePath().fillPath()}}),this.tweens.add({targets:d,delay:1500,alpha:{from:0,to:1},ease:"Quad",duration:500,repeat:0,yoyo:!1});let f=this,g=function(){f.game.scene.stop("ClueReveal"),handoffToFrontEnd(e.playerWon)};this.sound.play("clue-reveal"),this.time.addEvent({delay:1500,loop:!1,callback:()=>{this.sys.game.device.os.desktop?this.input.keyboard.on("keydown",g):this.input.on("pointerdown",g)}})}});let isGameReady=!1,isPageReady=!1;function startGame(){if(isPageReady=!0,isGameReady){let e=game.scene.getScenes(!0);for(let t=0;t<e.length;t++)game.scene.stop(e[t]);game.scene.start("WaitForInput")}}function handoffToFrontEnd(e){startGame()}function createLightContainer(e){let t=e.add.image(0,0,"atlas","light"),s=t.width/2,a=t.height/2,i="0x000000";return e.add.container(0,0,[t,e.add.rectangle(-750,-1334-a,1500,1336,i).setOrigin(0,0),e.add.rectangle(-750-s,-a,752,t.height,i).setOrigin(0,0),e.add.rectangle(s-2,-a,750-s+2,t.height,i).setOrigin(0,0)]).setDepth(2e3).setAlpha(1).setScale(.5)}window.startGame=startGame,document.body.addEventListener("touchstart",(function(e){game.scene.isActive("Game")&&game.scene.getScene("Game").pageTouchStart(e)}),{passive:!0}),document.body.addEventListener("touchend",(function(e){game.scene.isActive("Game")&&game.scene.getScene("Game").pageTouchEnd(e)}),{passive:!0}),document.body.addEventListener("touchmove",(function(e){game.scene.isActive("Game")&&game.scene.getScene("Game").pageTouchMove(e)}),{passive:!0});